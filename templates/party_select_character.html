{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container mt-5 text-light">
  <h2 class="mb-4">
    Select Your Character for <span class="text-gold">{{ party.name }}</span>
  </h2>

  {% if characters %}
    <div class="row">
      {% for char in characters %}
      <div class="col-md-4 mb-4">
        <div class="card parchment-card bg-dark text-light shadow-lg h-100 
             {% if selected_pc and selected_pc.character.id == char.id %}
               border border-warning border-3
             {% endif %}">
          <div class="card-body d-flex flex-column justify-content-between">
            <div>
              <div class="d-flex justify-content-between align-items-start">
                <h4 class="card-title text-gold">{{ char.name }}</h4>
                {% if selected_pc and selected_pc.character.id == char.id %}
                  <span class="badge bg-warning text-dark">Selected</span>
                {% endif %}
              </div>

              <p class="card-text mb-2">
                Level {{ char.level }} {{ char.class_type }}<br>
                Race: {{ char.race|default:"Unknown" }}
              </p>

              <!-- Health -->
              <div class="mt-2">
                <small class="text-uppercase fw-bold text-dark">Health (HP)</small>
                <div class="progress" style="height: 14px;">
                  <div class="progress-bar bg-danger"
                       style="width: {{ char.health|default:0 }}%;"
                       aria-valuenow="{{ char.health|default:0 }}"
                       aria-valuemin="0" aria-valuemax="100">
                    {{ char.health }}
                  </div>
                </div>
              </div>

              <!-- Mana -->
              <div class="mt-2">
                <small class="text-uppercase fw-bold text-dark">Mana (MP)</small>
                <div class="progress" style="height: 14px;">
                  <div class="progress-bar bg-info"
                       style="width: {{ char.mana|default:0 }}%;"
                       aria-valuenow="{{ char.mana|default:0 }}"
                       aria-valuemin="0" aria-valuemax="100">
                    {{ char.mana }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Select Button -->
            <form method="POST" class="mt-4">
              {% csrf_token %}
              <input type="hidden" name="character_id" value="{{ char.id }}">
              <button type="submit"
                      class="btn {% if selected_pc and selected_pc.character.id == char.id %}
                                   btn-secondary disabled
                                 {% else %}
                                   btn-gold
                                 {% endif %} w-100">
                {% if selected_pc and selected_pc.character.id == char.id %}
                  Currently Selected
                {% else %}
                  Select Character
                {% endif %}
              </button>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <p>You donâ€™t have any characters yet.
      <a href="{% url 'characters' %}" class="text-gold">Create one first!</a>
    </p>
  {% endif %}

  <div class="mt-4">
    <a href="{% url 'party_detail' party.id %}" class="btn btn-secondary">Back to Party</a>
  </div>
</div>

{% endblock %}
