{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
  <h1 class="mb-4 text-center text-warning fw-bold">
    {% if party %}{{ party.name }}{% else %}Your Party{% endif %}
  </h1>

  <!-- Empty party state -->
  {% if not party %}
    <div class="card shadow-sm p-4 text-center bg-dark text-light">
      <p class="lead">You’re not currently in a party. Create one below!</p>

      <form method="post" class="d-flex justify-content-center mt-3">
        {% csrf_token %}
        <input type="text" name="party_name" class="form-control w-50 me-2"
               placeholder="Enter new party name">
        <button type="submit" name="create_party" class="btn btn-warning fw-bold px-4">
          + Create Party
        </button>
      </form>
    </div>

  {% else %}
  <!-- Existing party section -->
    <div class="card shadow-sm mb-4">
      <div class="card-body bg-dark text-light">
        <h4 class="card-title text-warning">Dungeon Master</h4>
        <p class="card-text">{{ party.dungeon_master.username }}</p>
      </div>
    </div>

    <div class="card shadow-sm mb-4">
      <div class="card-body bg-dark text-light">
        <h4 class="card-title text-warning">Party Members</h4>
        {% if party.members.all %}
          <ul class="list-group list-group-flush">
            {% for member in party.members.all %}
              <li class="list-group-item bg-secondary text-light d-flex justify-content-between align-items-center">
                <span>{{ member.username }}</span>
                <form method="post" action="{% url 'party_remove_member' party.pk %}" class="m-0">
                  {% csrf_token %}
                  <input type="hidden" name="member_id" value="{{ member.id }}">
                  <button class="btn btn-sm btn-warning fw-bold text-dark">
                    ✖ Remove
                  </button>
                </form>
              </li>
            {% empty %}
              <li class="list-group-item bg-dark text-light">No members in this party yet.</li>
            {% endfor %}
          </ul>
        {% else %}
          <p>No members in this party yet.</p>
        {% endif %}
      </div>
    </div>

    <!-- Invite member -->
    <div class="card shadow-sm mb-4">
      <div class="card-body bg-dark text-light">
        <h4 class="card-title text-warning">Invite a Member</h4>
        <form method="post" action="{% url 'party_invite' party.pk %}">
          {% csrf_token %}
          <div class="input-group">
            <input type="text" name="username" class="form-control" placeholder="Enter username" required>
            <button class="btn btn-warning fw-bold text-dark" type="submit">Invite</button>
          </div>
        </form>
      </div>
    </div>

  {% endif %}

  <div class="text-center mt-4">
    <a href="{% url 'characters' %}" class="btn btn-outline-warning px-4 fw-bold">
      ← Back to Characters
    </a>
  </div>
</div>
{% endblock %}
