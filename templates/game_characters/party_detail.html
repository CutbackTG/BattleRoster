{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
  <h1 class="mb-4">{{ party.name }}</h1>

  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Dungeon Master</h5>
      <p class="card-text">{{ party.dungeon_master.username }}</p>
    </div>
  </div>

  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Party Members & Characters</h5>
      {% if party.members.all %}
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Username</th>
              <th>Character</th>
              <th>HP</th>
              <th>MP</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for member in party.members.all %}
              {% for character in member.character_set.all %}
                <tr>
                  <td>{{ member.username }}</td>
                  <td>{{ character.name }}</td>
                  <td>{{ character.hp }}</td>
                  <td>{{ character.mp }}</td>
                  <td>
                    <form method="post" action="{% url 'party_remove_member' party.pk %}">
                      {% csrf_token %}
                      <input type="hidden" name="member_id" value="{{ member.id }}">
                      <button class="btn btn-sm btn-danger">Remove</button>
                    </form>
                  </td>
                </tr>
              {% empty %}
                <tr><td colspan="5">No characters found.</td></tr>
              {% endfor %}
            {% empty %}
              <tr><td colspan="5">No members found.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>No members in this party yet.</p>
      {% endif %}
    </div>
  </div>

  <div class="text-end mt-4">
    <a href="{% url 'party_invite' party.pk %}" class="btn btn-primary">+ Invite Player</a>
    <a href="{% url 'characters' %}" class="btn btn-secondary">‚Üê Back to Character List</a>
  </div>
</div>
{% endblock %}
